# 后室 (The Backrooms) - 终极扩展设计 v3.0 (Metroidvania Style)

## 1. 世界观架构：层级网络 (The Level Web)

为了大幅增加游玩时间，我们将线性流程重构为**以枢纽为中心的放射状网络**。

### 1.1 核心枢纽 (Hubs)
*   **Level 11: 混凝土森林**: 玩家的主要基地。拥有安全屋、黑市、任务板。连接 Level 4, 9, 52。
*   **The Metro (地铁系统)**: 快速旅行系统。连接 Level 11, Level 3, Level 36。需要“车票”解锁站点。

### 1.2 探索区域规划
*   **深海区 (The Depths)**: Level 7 (海洋) -> Level 8 (洞穴) -> Level 9 (黑暗郊区)。
    *   *解锁条件*: 需要在 Level 4 找到潜水装备，在 Level 11 购买高流明手电。
*   **学院区 (The Academy)**: Level 52 (学校) -> Level 188 (窗之庭) -> Level 94 (动画)。
    *   *解锁条件*: 需要“校长ID卡”和“蓝色磁带”。
*   **终焉区 (The Terminus)**: Level 3999 (街机厅) -> The End (伪结局) -> Level 9223372036854775807 (真结局)。

---

## 2. 新增层级详细设计 (New Levels)

### Level 8: 洞穴系统 (Cave System)
*   **特征**: 幽闭恐惧症的极致。充满蜘蛛网和未知的粘液。
*   **实体**: 蜘蛛之母 (The Mother)。
*   **玩法**: **迷宫追逐**。你需要用火把驱赶小型蜘蛛，同时躲避巨大的母体。
*   **关键道具**: **蜘蛛丝纤维** (用于在 Level 11 制作防弹背心)。

### Level 9: 黑暗郊区 (Darkened Suburbs)
*   **特征**: 永夜的住宅区。路灯闪烁，房屋内空无一人。
*   **实体**: 邻居 (The Neighborhood Watch)。
*   **玩法**: **潜行暗杀**。进入房屋搜刮物资，但如果被路灯照到就会被“邻居”发现。
*   **剧情**: 寻找 K 博士的童年故居（记忆碎片 #3）。

### Level 52: 学校 (School Halls)
*   **特征**: 一所无限大的 20 世纪高中。走廊里回荡着下课铃。
*   **实体**: 严厉的老师、霸凌者。
*   **玩法**: **社交解谜**。你需要假装成学生，遵守校规（如不许奔跑、不许吃东西），通过考试来获取情报。
*   **关键道具**: **历史课本** (揭示后室起源的隐喻)。

### Level 3999: 真正的街机厅 (The True Arcade)
*   **特征**: 一个充满了 80 年代街机游戏的霓虹灯大厅。
*   **玩法**: **任务清单**。你需要完成“管理员”给出的一系列荒谬任务（如“喝掉 100 瓶杏仁水”、“在 Level 0 倒着走 1000 米”）来积累积分。
*   **奖励**: **现实切片** (通往真结局的钥匙)。

### The End (伪结局)
*   **特征**: 一个巨大的图书馆，写着“THE END”。
*   **剧情陷阱**: 电脑屏幕上显示“恭喜通关，点击退出”。
*   **真相**: 如果点击，游戏会假装关闭，然后重置到 Level 0（二周目）。如果你拒绝点击并在图书馆寻找破绽，墙壁会崩塌，通往 Level 9223...

---

## 3. 实体生态系统 (Entity Ecosystem)

不仅是敌人，更是生态的一部分。

*   **中立实体**:
    *   **杰瑞 (Jerry)**: 在 Level 1/2 随机出现。如果你给它瓜子（在 Level 4 获得），它会给你一个持续 30 分钟的 SAN 值不减 BUFF。
    *   **布兰奇 (Blanche)**: Level 11 图书馆管理员。可以回答你关于层级历史的问题，但代价是你的记忆（扣除 EXP）。
*   **敌对实体进化**:
    *   **猎犬**: 在 Level 1 是普通的狗；在 Level 9 会进化成“暗夜猎犬”，速度更快且畏光。
    *   **笑魇**: 在 Level 2 是静态陷阱；在 Level 8 会主动巡逻。

---

## 4. 复杂的非线性任务链 (Quest Chains)

### 任务链 A: 建立前哨站
1.  **触发**: Level 11 的 MEG 指挥官。
2.  **步骤**:
    *   去 Level 1 收集 50 瓶杏仁水。
    *   去 Level 3 窃取 5 个高能电池。
    *   去 Level 8 消灭 3 只巨型蜘蛛。
3.  **奖励**: 解锁 Level 11 的安全屋（免费回血/存档），并获得 **Level 94 的通行证**。

### 任务链 B: 疯狂的真理
1.  **触发**: Level 2 的神秘涂鸦。
2.  **步骤**:
    *   在 5 个不同层级找到“失落一族”的祭坛。
    *   献祭你的手电筒（失去照明工具）。
    *   在黑暗中存活 10 分钟。
3.  **奖励**: 获得 **“灵视” (True Sight)** 能力。可以看到隐藏的门和实体的真实形态（SAN 值上限减半，但能看到更多剧情）。

---

## 5. 数据结构扩容方案

为了管理如此庞大的任务和状态，建议将 `state` 对象重构为：

```javascript
// 复杂状态管理示例
state = {
    player: {
        hp: 100,
        sanity: 100,
        level: 5, // 玩家等级，影响战斗力
        skills: ['stealth', 'lockpick'] // 技能树
    },
    inventory: [
        { id: 'diving_gear', durability: 80 },
        { id: 'metro_ticket', uses: 3 }
    ],
    quests: {
        active: ['build_outpost', 'find_k'],
        completed: ['tutorial'],
        failed: []
    },
    world: {
        level11_reputation: 50, // 阵营声望
        level52_school_bell: false, // 动态环境状态
        unlocked_hubs: ['level11']
    },
    persistent: {
        deaths: 3,
        play_time: 12000
    }
};